---
// ============================================================================
// FILE: src/pages/projects.astro
// ACTION: FULL REPLACEMENT
// CHANGES: 
// 1. Reordered sections (Active Projects first, then Getting Involved)
// 2. Replaced "Propose Your Own" with "Build Your Own" empowerment section
// 3. Updated hero copy to be punchier
// 4. Separated active vs all projects
// 5. Using SectionHeader component for consistency
// ============================================================================
import BaseLayout from "../layouts/BaseLayout.astro";
import ArcCanvas from "../components/ArcCanvas.astro";
import SiteHeader from "../components/SiteHeader.astro";
import PageNavigation from "../components/PageNavigation.astro";
import Card from "../components/Card.astro";
import LinkButton from "../components/LinkButton.astro";
import StatusBadge from "../components/StatusBadge.astro";
import SectionHeader from "../components/SectionHeader.astro";

import { getCollection } from 'astro:content';
import "../styles/pages/projects.css";

import { withBase } from '../utils/paths';
import { buildSEO } from '../utils/seo';
import { EXTERNAL_LINKS } from '../config/constants';

// Get all projects and separate by status
const allProjects = await getCollection('projects');
const activeProjects = allProjects.filter(p => p.data.status === 'active');
const otherProjects = allProjects.filter(p => p.data.status !== 'active');

const seo = buildSEO({
  title: "Projects",
  description: "Active research projects in plasma technology for ecological repair. Open, collaborative, and building in public.",
  path: "/projects",
  siteUrl: Astro.site,
});
---

<BaseLayout title={seo.title} description={seo.description} bodyClass="page-projects" seo={seo}>
  <ArcCanvas />
  <SiteHeader active="projects" />

  <main id="main-content" class="page-shell" aria-labelledby="projects-title">
    
    <!-- HERO SECTION -->
    <header class="projects-hero" aria-labelledby="projects-title">
      <p class="eyebrow">Early-Stage Collaborative Research</p>
      <h1 id="projects-title">Projects</h1>
      <p class="lead">
        <strong>Real problems. Open solutions.</strong> Each project tackles ecological repair 
        through <em>collaborative research</em> ‚Äî testing hypotheses, building hardware, and 
        sharing everything we learn. <strong>You can join at any stage.</strong>
      </p>
    </header>

    <!-- ACTIVE PROJECTS SECTION (Priority placement!) -->
    {activeProjects.length > 0 && (
      <section class="active-projects-section" aria-labelledby="active-projects-title">
        <SectionHeader 
          title="Active Projects" 
          subtitle="These projects are actively seeking collaborators and building in public."
        />
        
        <div class="projects-grid">
          {activeProjects.map((project) => (
            <Card as="article" class="project-card">
              <div class="card-header">
                <h3>
                  <a href={withBase(`/projects/${project.slug}`)}>{project.data.title}</a>
                </h3>
                <StatusBadge status={project.data.status} />
              </div>
              <p class="card-summary">{project.data.summary}</p>
              <p class="card-updated">Last updated: {project.data.lastUpdated}</p>
              <div class="card-actions">
                <LinkButton href={withBase(`/projects/${project.slug}`)} variant="outline" icon="arrow-right">
                  Learn More
                </LinkButton>
              </div>
            </Card>
          ))}
        </div>
      </section>
    )}

    <!-- GETTING INVOLVED SECTION -->
    <section class="getting-involved-section" aria-labelledby="getting-involved-title">
      <SectionHeader 
        title="Getting Involved" 
        subtitle="arc^ is in early stages, which means you can help shape the direction from the ground up."
      />
      
      <div class="involvement-grid">
        <Card as="article" class="involvement-card">
          <div class="card-icon">üéì</div>
          <h3>For Students</h3>
          <p>Working on a final year project, honours thesis, or PhD? You can explore arc^ projects as part of your coursework.</p>
          <p class="card-note">We're here to support you ‚Äî whether that's access to equipment, guidance on safety protocols, or help framing research questions.</p>
        </Card>

        <Card as="article" class="involvement-card">
          <div class="card-icon">üî¨</div>
          <h3>For Researchers</h3>
          <p>Have expertise in plasma physics, materials science, or ecological systems? Your knowledge can help validate approaches or identify new directions.</p>
          <p class="card-note">This isn't about gatekeeping ‚Äî it's about learning together and building on each other's insights.</p>
        </Card>

        <Card as="article" class="involvement-card">
          <div class="card-icon">üõ†Ô∏è</div>
          <h3>For Everyone</h3>
          <p>You don't need a degree to contribute. Maybe you're a maker, a tinkerer, or someone with lived experience of the problems we're trying to solve.</p>
          <p class="card-note">If you're curious, willing to learn, and committed to safety ‚Äî there's a place for you.</p>
        </Card>
      </div>

      <div class="involvement-cta">
        <LinkButton href={EXTERNAL_LINKS.formURL} variant="primary" icon="external">
          Get Involved
        </LinkButton>
      </div>
    </section>

    <!-- BUILD YOUR OWN SECTION (Replaces "Propose Your Own") -->
    <section class="build-your-own-section" aria-labelledby="build-your-own-title">
      <SectionHeader 
        title="Build Your Own" 
        subtitle="Don't see what you're looking for? You don't need our permission."
      />
      
      <Card class="build-your-own-content">
        <p>
          arc^ isn't about gatekeeping ‚Äî it's about <em>enabling</em>. If you understand 
          <a href={withBase("/how")}>our philosophy</a> and commit to our <a href={withBase("/how/safety")}>safety protocols</a> 
          and <a href={withBase("/how/licensing")}>open licensing</a>, you can start your own arc^ project.
        </p>
        <p>
          <strong>You have the power.</strong> Document your work. Share openly. Build for 
          <em>life over profit</em>. That's all we ask.
        </p>
        <div style="margin-top: 1.5rem;">
          <LinkButton href={withBase("/how")} variant="outline" icon="arrow-right">
            Learn the Philosophy
          </LinkButton>
        </div>
      </Card>
    </section>

    <!-- ALL PROJECTS SECTION (if there are non-active projects) -->
    {otherProjects.length > 0 && (
      <section class="all-projects-section" aria-labelledby="all-projects-title">
        <SectionHeader 
          title="All Projects" 
          subtitle="Including early ideas, paused work, and completed research."
        />
        
        <div class="projects-grid">
          {otherProjects.map((project) => (
            <Card as="article" class="project-card">
              <div class="card-header">
                <h3>
                  <a href={withBase(`/projects/${project.slug}`)}>{project.data.title}</a>
                </h3>
                <StatusBadge status={project.data.status} />
              </div>
              <p class="card-summary">{project.data.summary}</p>
              <p class="card-updated">Last updated: {project.data.lastUpdated}</p>
              <div class="card-actions">
                <LinkButton href={withBase(`/projects/${project.slug}`)} variant="outline" icon="arrow-right">
                  Learn More
                </LinkButton>
              </div>
            </Card>
          ))}
        </div>
      </section>
    )}

    <!-- LEGAL REMINDER -->
    <section class="legal-section">
      <h3>Open by Default</h3>
      <p>All arc^ projects follow our <a href={withBase("/how/licensing")}>non-extractive licensing model</a>. Research outputs, data, and designs stay in the commons.</p>
      <p>This ensures that <em>the many benefit</em>, not just a few.</p>
    </section>

  </main>

  <PageNavigation currentPage="projects" />
</BaseLayout>