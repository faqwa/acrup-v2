---
// ============================================================================
// IMPORTS - Updated to use shared utilities
// ============================================================================
import BaseLayout from "../layouts/BaseLayout.astro";
import ArcCanvas from "../components/ArcCanvas.astro";
import SiteHeader from "../components/SiteHeader.astro";
import PageNavigation from "../components/PageNavigation.astro";
import '../styles/pages/home.css';

// NEW: Import utilities
import { withBase } from '../utils/paths';
import { buildSEO } from '../utils/seo';

// ============================================================================
// SEO - Simplified using buildSEO utility
// ============================================================================
const seo = buildSEO({
  title: "arc^",  // buildSEO will add "- Open Plasma Research for Ecological Repair"
  description: "arc^ is an open research framework building plasma technology for ecological repair. We work openly, share everything, and build technology that serves life over profit.",
  path: "/",
  siteUrl: Astro.site,
});
---

<BaseLayout 
  title={seo.title}
  description={seo.description} 
  bodyClass="page-home" 
  seo={seo}
>
  <ArcCanvas />
  <SiteHeader active="home" />
  
  <main id="main-content" class="page-shell" aria-labelledby="main-title">
    
    <!-- HERO INTRO - No changes, keep exact structure -->
    <header class="home-hero" aria-labelledby="main-title">
      <p class="eyebrow">Building Technology for a Better Future</p>
      <h1 id="main-title">arc^</h1>
      <p class="lead home-lede">
        Arc^ is an <strong>open research framework</strong> building plasma technology for ecological repair. 
        We bring together <strong>researchers, builders, and communities</strong> to develop technology openly 
        and ethically — <em>technology that serves life, not profit</em>. Whether you're a student, engineer, 
        scientist, or community partner, if you're ready to work transparently and collaboratively, there's a 
        place for you here.
      </p>      
    </header>

    <!-- ARC UP ETYMOLOGY CALLOUT 
         Keep this EXACTLY as is - it's unique to the homepage
         This section has custom styling and interactions that shouldn't be componentized -->
    <section class="etymology-callout" aria-labelledby="etymology-heading">
      <div class="etymology-content">
        <h2 id="etymology-heading" class="visually-hidden">Origin of arc^</h2>
        <div class="pronunciation-block">
          <div class="pronunciation-title">
            <span class="arc-text">arc<sup>^</sup></span>
            <span class="pronunciation-text">/ark-up/</span>
          </div>
          <button class="audio-button" aria-label="Play pronunciation of arc up" type="button">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
            <span class="button-text">Listen</span>
          </button>
        </div>
        <p class="etymology-definition">
          <strong>"to arc up"</strong> <em>(Australian slang)</em><br>
          to rise in defense of people and planet
        </p>
      </div>
    </section>

    <!-- NAVIGATION CARDS 
         Keep this structure - these are unique homepage nav cards, not LinkButton components
         They have specific styling and hover effects that shouldn't be changed -->
    <nav class="home-nav-cards" aria-label="Main site sections">
      <a href={withBase("/projects")} class="nav-card">
        <h3>Projects</h3>
        <p>See our open research in plasma technology and ecological applications</p>
        <span class="nav-card-arrow" aria-hidden="true">→</span>
      </a>
      
      <a href={withBase("/how")} class="nav-card">
        <h3>Method</h3>
        <p>Understand how we work: transparently, ethically, regeneratively</p>
        <span class="nav-card-arrow" aria-hidden="true">→</span>
      </a>
      
      <a href={withBase("/join")} class="nav-card">
        <h3>Join</h3>
        <p>Contribute to open research and help build technology for life</p>
        <span class="nav-card-arrow" aria-hidden="true">→</span>
      </a>
    </nav>

  </main>

  <PageNavigation currentPage="home" />

  <!-- Audio pronunciation script - Keep as is -->
  <script>
    // Audio pronunciation using uploaded file
    const btn = document.querySelector('.audio-button');
    if (btn) {
      btn.addEventListener('click', () => {
        const base = import.meta.env.BASE_URL || '/';
        const audioPath = `${base}audio/EN-AU_ck1_arc_up.mp3`.replace('//', '/');
        const audio = new Audio(audioPath);
        
        audio.play().catch(err => {
          console.error('Audio playback failed:', err);
          // Fallback to speech synthesis
          if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance('arc up');
            utterance.rate = 0.8;
            utterance.pitch = 1;
            window.speechSynthesis.speak(utterance);
          }
        });
      });
    }
  </script>

</BaseLayout>

<!-- 
============================================================================
MIGRATION SUMMARY - index.astro (Homepage)
============================================================================

✅ WHAT CHANGED (Minimal - utilities only):
1. Imports:
   - Added: withBase, buildSEO utilities
   - Removed: Duplicate withBase function definition
   - Removed: Manual SEO object construction

2. SEO simplified:
   - Used buildSEO() utility instead of manual construction
   - Same functionality, less code

3. Used withBase from utilities:
   - All navigation card href attributes now use imported withBase
   - No functional changes

✅ WHAT DIDN'T CHANGE (Preserved ALL unique homepage design):
- Hero section structure - UNCHANGED
- Etymology section - UNCHANGED (unique to homepage, custom styling)
- Audio pronunciation button - UNCHANGED
- Navigation cards - UNCHANGED (unique homepage pattern)
- ALL CSS classes maintained
- Client-side script for audio - UNCHANGED
- Visual appearance is IDENTICAL

✅ WHY SO FEW CHANGES:
The homepage is simple and has UNIQUE elements that shouldn't be componentized:
- Etymology callout with custom gradient background and pronunciation audio
- Special navigation cards with unique hover effects
- No surface-panel or button elements that need component replacement
- The design is already clean and doesn't have code duplication

✅ KEY DECISION:
Did NOT use LinkButton for nav cards because:
- They have unique styling (.nav-card class)
- Custom hover effects and layout
- Not standard buttons - they're large promotional cards
- Would require extensive custom styling if converted to LinkButton
- Better to keep them as custom elements for the homepage

============================================================================
-->